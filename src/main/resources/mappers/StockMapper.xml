<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.no1.wms.stock.StockMapper">
   
   <!-- select -->
   <select id="count" parameterType="map" resultType="java.lang.Integer">
   		select count(*) from stock left join warehouse on stock.warehouse_id = warehouse.id left join product on stock.product_id = product.id left join product_category on product.kan_code = product_category.kan_code
   		<where>
			<choose>
				<when test="searchn == 0"> stock.activation = 1 and warehouse.name like concat('%',#{search},'%')</when>
				<when test="searchn == 1"> stock.activation = 1 and  product.name like concat('%',#{search},'%') </when>
			</choose>
		</where> 
   		order by stock.id desc limit #{start}, #{perPage}
   </select>
   
   <select id="list" parameterType="map" resultType="com.no1.wms.stock.StockDto">
   		select * from stock left join warehouse on stock.warehouse_id = warehouse.id left join product on stock.product_id = product.id left join product_category on product.kan_code = product_category.kan_code
   		<where>
			<choose>
				<when test="searchn == 0"> stock.activation = 1 and warehouse.name like concat('%',#{search},'%')</when>
				<when test="searchn == 1"> stock.activation = 1 and product.name like concat('%',#{search},'%') </when>
			</choose>
		</where> 
   		order by stock.id desc limit #{start}, #{perPage}
   </select>
   
   <select id="stockOne" parameterType="String" resultType="com.no1.wms.stock.StockDto">
   		selct * from stock where id = #{id}
   </select>
   <!-- select -->
   
   
   <!-- update -->
   <update id="updateStock" parameterType="com.no1.wms.stock.StockDto">
   		update stock
   		set quantity = #{dto.quantity}
		where id = #{dto.id}
   </update>
   <!-- update -->
   
   
   <!-- insert -->
   <insert id="createStock" parameterType="com.no1.wms.stock.StockDto">
   		insert into stock (id, warehouse_id, product_id, quantity, activation)
   		values (#{dto.id}, #{dto.warehouse_id}, #{dto.product_id}, #{dto.quantity}, 1)
   </insert>
   <!-- insert -->

	<!-- delete -->
	<delete id="deleteStock" parameterType="String">
		delete from stock where no = #{id}
	</delete>
	<!-- delete -->
</mapper>